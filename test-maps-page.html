<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Test - VibeVoyage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #map { height: 400px; width: 100%; border: 1px solid #ccc; margin: 20px 0; }
        .info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Google Maps Integration Test</h1>
    
    <div class="info">
        <h3>Testing Google Maps API Integration</h3>
        <p><strong>API Key:</strong> AIzaSyC8zTjtFNz-aACgGDE4utlb1fMhBJO82dE</p>
        <p><strong>Libraries:</strong> places, geometry</p>
    </div>

    <div id="status" class="info">
        ‚è≥ Loading Google Maps API...
    </div>

    <div id="map"></div>

    <div>
        <button onclick="testGeocoding()">Test Geocoding</button>
        <button onclick="testPlaces()">Test Places API</button>
        <button onclick="addTestMarkers()">Add Test Markers</button>
    </div>

    <div id="results"></div>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8zTjtFNz-aACgGDE4utlb1fMhBJO82dE&libraries=places,geometry&callback=initMap"></script>
    
    <script>
        let map;
        let placesService;

        function initMap() {
            console.log('‚úÖ Google Maps API loaded successfully');
            document.getElementById('status').innerHTML = '<span class="success">‚úÖ Google Maps API loaded successfully!</span>';
            
            // Initialize map centered on Paris
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: { lat: 48.8566, lng: 2.3522 }
            });

            // Initialize Places service
            placesService = new google.maps.places.PlacesService(map);
            
            console.log('‚úÖ Map initialized');
        }

        function testGeocoding() {
            const geocoder = new google.maps.Geocoder();
            const destination = 'Tokyo, Japan';
            
            document.getElementById('results').innerHTML = '‚è≥ Testing geocoding for ' + destination + '...';
            
            geocoder.geocode({ address: destination }, (results, status) => {
                if (status === 'OK') {
                    const location = results[0].geometry.location;
                    document.getElementById('results').innerHTML = 
                        '<div class="success">‚úÖ Geocoding successful!<br>' +
                        'Location: ' + location.lat() + ', ' + location.lng() + '</div>';
                    
                    // Center map on result
                    map.setCenter(location);
                    new google.maps.Marker({
                        position: location,
                        map: map,
                        title: destination
                    });
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="error">‚ùå Geocoding failed: ' + status + '</div>';
                }
            });
        }

        function testPlaces() {
            if (!placesService) {
                document.getElementById('results').innerHTML = 
                    '<div class="error">‚ùå Places service not initialized</div>';
                return;
            }

            document.getElementById('results').innerHTML = '‚è≥ Searching for hotels near map center...';
            
            const request = {
                location: map.getCenter(),
                radius: 5000,
                type: 'lodging'
            };

            placesService.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    document.getElementById('results').innerHTML = 
                        '<div class="success">‚úÖ Found ' + results.length + ' hotels!<br>' +
                        'First hotel: ' + results[0].name + ' (Rating: ' + (results[0].rating || 'N/A') + ')</div>';
                    
                    // Add marker for first hotel
                    if (results[0]) {
                        new google.maps.Marker({
                            position: results[0].geometry.location,
                            map: map,
                            title: results[0].name,
                            icon: 'https://maps.google.com/mapfiles/ms/icons/lodging.png'
                        });
                    }
                } else {
                    document.getElementById('results').innerHTML = 
                        '<div class="error">‚ùå Places search failed: ' + status + '</div>';
                }
            });
        }

        function addTestMarkers() {
            // Sample activities with coordinates
            const activities = [
                { name: 'Eiffel Tower', lat: 48.8584, lng: 2.2945, category: 'sightseeing' },
                { name: 'Louvre Museum', lat: 48.8606, lng: 2.3376, category: 'sightseeing' },
                { name: 'French Restaurant', lat: 48.8566, lng: 2.3522, category: 'food' }
            ];

            activities.forEach((activity, index) => {
                const marker = new google.maps.Marker({
                    position: { lat: activity.lat, lng: activity.lng },
                    map: map,
                    title: activity.name,
                    label: (index + 1).toString(),
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 15,
                        fillColor: getActivityColor(activity.category),
                        fillOpacity: 1,
                        strokeColor: 'white',
                        strokeWeight: 2
                    }
                });

                const infoWindow = new google.maps.InfoWindow({
                    content: '<div><h3>' + activity.name + '</h3><p>Category: ' + activity.category + '</p></div>'
                });

                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
            });

            document.getElementById('results').innerHTML = 
                '<div class="success">‚úÖ Added ' + activities.length + ' test markers!</div>';
        }

        function getActivityColor(category) {
            switch (category) {
                case 'food': return '#F97316';
                case 'transport': return '#3B82F6';
                case 'activity': return '#8B5CF6';
                case 'sightseeing': return '#10B981';
                default: return '#6B7280';
            }
        }

        // Handle API loading errors
        window.gm_authFailure = function() {
            document.getElementById('status').innerHTML = 
                '<div class="error">‚ùå Google Maps API authentication failed. Please check the API key.</div>';
        };
    </script>
</body>
</html>